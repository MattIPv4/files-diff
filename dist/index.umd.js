!function(e,d){"object"==typeof exports&&"undefined"!=typeof module?module.exports=d(require("escape-html"),require("string-similarity"),require("diff")):"function"==typeof define&&define.amd?define(["escape-html","string-similarity","diff"],d):(e||self).filesDiff=d(e.escapeHtml,e.stringSimilarity,e.diff)}(this,function(e,d,t){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),a=n(d);function i(){return(i=Object.assign||function(e){for(var d=1;d<arguments.length;d++){var t=arguments[d];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}const o=(e,d)=>{if(d.highlightFunction){const t=e.value.match(/^(\s*)(.*)(\s*)$/),n=d.highlightFunction(t?t[2]:e.value,e.added,e.removed);e.value=`${t?t[1]:""}${n}${t?t[3]:""}`}return e};var l=(e,d)=>{const t=e.reduce((e,t,n,a)=>{const l=i({},t);if(d.escapeHtml&&(l.value=r.default(l.value)),l.added=!!l.added,l.removed=!!l.removed,"count"in l&&delete l.count,!l.removed&&!l.added)return e.push(l),e;if(!d.ignoreWhitespace)return e.push(o(l,d)),e;if(n>0&&(a[n-1].removed&&t.added||a[n-1].added&&t.removed)&&a[n-1].value.replace(/\s/g,"")===t.value.replace(/\s/g,""))return e.push({added:!1,removed:!1,value:l.value}),e;if(n<a.length-1&&(a[n+1].removed&&t.added||a[n+1].added&&t.removed)&&a[n+1].value.replace(/\s/g,"")===t.value.replace(/\s/g,""))return e;const s=l.value.split("\n").map((e,d,t)=>`${e}${d<t.length-1?"\n":""}`);for(const t of s)e.push(o({added:l.added,removed:l.removed,value:t},d));return e},[]),n={added:null,removed:null};return t.reduce((e,d)=>(d.added===n.added&&d.removed===n.removed?e[e.length-1].value+=d.value:e.push(d),n.added=d.added,n.removed=d.removed,e),[])},s=(e,d,n)=>{const r=t.diffChars(d,e);return l(r,n)},u=(e,d,n)=>{const r=t.diffLines(d,e);return l(r,n)};return(e,d,t)=>{(t=t||{}).similarity="number"==typeof t.similarity?Math.min(Math.max(t.similarity,0),1):.5,t.newAsAdded=void 0!==t.newAsAdded&&!!t.newAsAdded,t.escapeHtml=void 0===t.escapeHtml||!!t.escapeHtml,t.ignoreWhitespace=void 0===t.ignoreWhitespace||!!t.ignoreWhitespace;const n=((e,d,t)=>{const n=Object.keys(e),r=Object.keys(d),i=r.filter(e=>!n.includes(e)),o=n.filter(e=>!r.includes(e)),l=new Set(o),s={};for(const n of i){if(0===l.size)continue;const r=Array.from(l).map(d=>[d,e[d]]),i=a.default.findBestMatch(d[n],r.map(e=>e[1]));if(i.bestMatch.rating<t)continue;const o=r[i.bestMatchIndex][0];s[o]=n,l.delete(o)}return s})(e,d,t.similarity),i={};for(const a in e){if(!Object.prototype.hasOwnProperty.call(e,a))continue;i[a]={name:[{added:!1,removed:!1,value:t.escapeHtml?r.default(a):a}],content:[{added:!1,removed:!1,value:t.escapeHtml?r.default(e[a]):e[a]}]};const o=a in n?n[a]:a in d?a:null,l=o?d[o]:null;null!==o?(a!==o&&(i[a].name=s(a,o,t)),e[a]!==l&&(i[a].content=u(e[a],l,t))):(i[a].name[0].added=t.newAsAdded,i[a].content[0].added=t.newAsAdded)}return i}});
