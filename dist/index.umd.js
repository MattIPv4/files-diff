!function(e,d){"object"==typeof exports&&"undefined"!=typeof module?module.exports=d(require("string-similarity"),require("diff"),require("escape-html")):"function"==typeof define&&define.amd?define(["string-similarity","diff","escape-html"],d):(e=e||self).filesDiff=d(e.stringSimilarity,e.diff,e.escapeHtml)}(this,function(e,d,t){function n(){return(n=Object.assign||function(e){for(var d=1;d<arguments.length;d++){var t=arguments[d];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const r=(e,d)=>{if(d.highlightFunction){const t=e.value.match(/^(\s*)(.*)(\s*)$/),n=d.highlightFunction(t?t[2]:e.value,e.added,e.removed);e.value=`${t?t[1]:""}${n}${t?t[3]:""}`}return e};var a=(e,d)=>{const a=e.reduce((e,a,i,o)=>{const l=n({},a);if(d.escapeHtml&&(l.value=t(l.value)),l.added=!!l.added,l.removed=!!l.removed,"count"in l&&delete l.count,!l.removed&&!l.added)return e.push(l),e;if(!d.ignoreWhitespace)return e.push(r(l,d)),e;if(i>0&&(o[i-1].removed&&a.added||o[i-1].added&&a.removed)&&o[i-1].value.replace(/\s/g,"")===a.value.replace(/\s/g,""))return e.push({added:!1,removed:!1,value:l.value}),e;if(i<o.length-1&&(o[i+1].removed&&a.added||o[i+1].added&&a.removed)&&o[i+1].value.replace(/\s/g,"")===a.value.replace(/\s/g,""))return e;const s=l.value.split("\n").map((e,d,t)=>`${e}${d<t.length-1?"\n":""}`);for(const t of s)e.push(r({added:l.added,removed:l.removed,value:t},d));return e},[]),i={added:null,removed:null};return a.reduce((e,d)=>(d.added===i.added&&d.removed===i.removed?e[e.length-1].value+=d.value:e.push(d),i.added=d.added,i.removed=d.removed,e),[])},i=(e,t,n)=>{const r=d.diffChars(t,e);return a(r,n)},o=(e,t,n)=>{const r=d.diffLines(t,e);return a(r,n)};return(d,t,n)=>{(n=n||{}).similarity="number"==typeof n.similarity?Math.min(Math.max(n.similarity,0),1):.5,n.newAsAdded=void 0!==n.newAsAdded&&!!n.newAsAdded,n.escapeHtml=void 0===n.escapeHtml||!!n.escapeHtml,n.ignoreWhitespace=void 0===n.ignoreWhitespace||!!n.ignoreWhitespace;const r=((d,t,n)=>{const r=Object.keys(d),a=Object.keys(t),i=a.filter(e=>!r.includes(e)),o=r.filter(e=>!a.includes(e)),l=new Set(o),s={};for(const r of i){const a=Array.from(l).map(e=>[e,d[e]]),i=e.findBestMatch(t[r],a.map(e=>e[1]));if(i.bestMatch.rating<n)continue;const o=a[i.bestMatchIndex][0];s[o]=r,l.delete(o)}return s})(d,t,n.similarity),a={};for(const e in d){if(!Object.prototype.hasOwnProperty.call(d,e))continue;a[e]={name:[{added:!1,removed:!1,value:e}],content:[{added:!1,removed:!1,value:d[e]}]};const l=e in r?r[e]:e in t?e:null,s=l?t[l]:null;if(null===l)return a[e].name[0].added=n.newAsAdded,void(a[e].content[0].added=n.newAsAdded);e!==l&&(a[e].name=i(e,l,n)),d[e]!==s&&(a[e].content=o(d[e],s,n))}return a}});
