!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("string-similarity"),require("diff"),require("escape-html")):"function"==typeof define&&define.amd?define(["string-similarity","diff","escape-html"],t):(e=e||self).filesDiff=t(e.stringSimilarity,e.diff,e.escapeHtml)}(this,function(e,t,d){function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var d=arguments[t];for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&(e[n]=d[n])}return e}).apply(this,arguments)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,d=d&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d;const r=(e,t)=>{if(t.highlightFunction){const d=e.value.match(/^(\s*)(.*)(\s*)$/),n=t.highlightFunction(d?d[2]:e.value,e.added,e.removed);e.value=`${d?d[1]:""}${n}${d?d[3]:""}`}return e};var a=(e,t)=>{const a=e.reduce((e,a,i,o)=>{const l=n({},a);if(t.escapeHtml&&(l.value=d(l.value)),l.added=!!l.added,l.removed=!!l.removed,"count"in l&&delete l.count,!l.removed&&!l.added)return e.push(l),e;if(!t.ignoreWhitespace)return e.push(r(l,t)),e;if(i>0&&(o[i-1].removed&&a.added||o[i-1].added&&a.removed)&&o[i-1].value.replace(/\s/g,"")===a.value.replace(/\s/g,""))return e.push({added:!1,removed:!1,value:l.value}),e;if(i<o.length-1&&(o[i+1].removed&&a.added||o[i+1].added&&a.removed)&&o[i+1].value.replace(/\s/g,"")===a.value.replace(/\s/g,""))return e;const s=l.value.split("\n").map((e,t,d)=>`${e}${t<d.length-1?"\n":""}`);for(const d of s)e.push(r({added:l.added,removed:l.removed,value:d},t));return e},[]),i={added:null,removed:null};return a.reduce((e,t)=>(t.added===i.added&&t.removed===i.removed?e[e.length-1].value+=t.value:e.push(t),i.added=t.added,i.removed=t.removed,e),[])},i=(e,d,n)=>{const r=t.diffChars(d,e);return a(r,n)},o=(e,d,n)=>{const r=t.diffLines(d,e);return a(r,n)};return(t,d,n)=>{(n=n||{}).similarity="number"==typeof n.similarity?Math.min(Math.max(n.similarity,0),1):.5,n.newAsAdded=void 0!==n.newAsAdded&&!!n.newAsAdded,n.escapeHtml=void 0===n.escapeHtml||!!n.escapeHtml,n.ignoreWhitespace=void 0===n.ignoreWhitespace||!!n.ignoreWhitespace;const r=((t,d,n)=>{const r=Object.keys(t),a=Object.keys(d),i=a.filter(e=>!r.includes(e)),o=r.filter(e=>!a.includes(e)),l=new Set(o),s={};for(const r of i){if(0===l.size)continue;const a=Array.from(l).map(e=>[e,t[e]]),i=e.findBestMatch(d[r],a.map(e=>e[1]));if(i.bestMatch.rating<n)continue;const o=a[i.bestMatchIndex][0];s[o]=r,l.delete(o)}return s})(t,d,n.similarity),a={};for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;a[e]={name:[{added:!1,removed:!1,value:e}],content:[{added:!1,removed:!1,value:t[e]}]};const l=e in r?r[e]:e in d?e:null,s=l?d[l]:null;null!==l?(e!==l&&(a[e].name=i(e,l,n)),t[e]!==s&&(a[e].content=o(t[e],s,n))):(a[e].name[0].added=n.newAsAdded,a[e].content[0].added=n.newAsAdded)}return a}});
